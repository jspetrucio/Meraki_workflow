# Story 13.1: Camera Analytics & Snapshots

> **Epic:** 13 - Camera Analytics, Sensors & Observability
> **Sprint:** TBD
> **Priority:** P1 (platform depth)
> **Points:** 5
> **Type:** Backend/Python
> **Agent:** @dev
> **Depends on:** None (independent)

---

## Status

**Draft**

---

## Story

**As a** facilities manager,
**I want** to access camera analytics and generate snapshots,
**so that** I can monitor occupancy and generate visual evidence.

---

## Acceptance Criteria

1. `discover_camera_analytics` returns analytics summary with people counts
2. `get_camera_analytics_zones` returns defined analytics zones
3. `generate_snapshot` captures a snapshot image from a camera
4. `get_video_link` returns a shareable video link with timestamp
5. Integration into `full_discovery()` output
6. Natural language: "show me camera analytics" or "generate snapshot from camera X" works

---

## Scope

| Layer | New Items | Details |
|-------|-----------|---------|
| `api.py` | 5 methods | `get_camera_analytics_overview`, `get_camera_analytics_zones`, `get_camera_analytics_history`, `generate_snapshot`, `get_video_link` |
| `discovery.py` | 1 function | `discover_camera_analytics` |
| `config.py` | â€” | Read-only feature, no config |
| `agent_tools.py` | 5 schemas | network-analyst tools |
| Safety | SAFE | Read-only (`generate_snapshot` triggers capture but is non-destructive) |

---

## Implementation Pattern

This story follows the standardized 7-step implementation pattern:

1. `api.py` -- Add SDK wrapper methods with `@log_api_call`
2. `discovery.py` -- Add discovery function with `client.safe_call()`
3. `config.py` -- N/A (read-only feature)
4. `agent_router.py` -- Register in `FUNCTION_REGISTRY`
5. `agent_tools.py` -- Add tool schemas + TOOL_SAFETY classification
6. `safety.py` -- Register in `SAFETY_CLASSIFICATION`
7. `tests/` -- Add comprehensive tests

**Note:** Both `SAFETY_CLASSIFICATION` (safety.py) and `TOOL_SAFETY` (agent_tools.py) must be updated.

---

## Tasks

- [ ] Add `get_camera_analytics_overview`, `get_camera_analytics_zones`, `get_camera_analytics_history`, `generate_snapshot`, `get_video_link` to api.py with `@log_api_call`
- [ ] Add `discover_camera_analytics` to discovery.py with `client.safe_call()`
- [ ] Add hardware product-type guard for MV cameras (skip if network has no `camera` product)
- [ ] Register camera analytics functions in FUNCTION_REGISTRY (agent_router.py)
- [ ] Add 5 tool schemas to agent_tools.py (network-analyst)
- [ ] Register safety classifications in safety.py (SAFE) and agent_tools.py (TOOL_SAFETY)
- [ ] Integrate camera analytics into `full_discovery()` output
- [ ] Add tests (target: >= 90% coverage)
- [ ] Verify all schemas pass `validate_tool_schema()` with `additionalProperties: False`

---

## File List

(To be populated during implementation)

---

## Dependencies

- Requires MV camera devices in network
- MV firmware >= 4.x for analytics features
- Camera analytics must be enabled in Dashboard

---

## Testing

### Expected Test Count: ~8-12 tests

**Test Coverage:**
- `test_get_camera_analytics_overview` - API method
- `test_get_camera_analytics_zones` - API method
- `test_get_camera_analytics_history` - API method
- `test_generate_snapshot` - API method
- `test_get_video_link` - API method
- `test_discover_camera_analytics` - Discovery function
- `test_camera_analytics_product_guard` - Hardware guard (skip when no MV)
- `test_function_registry_camera_analytics` - Router registration
- `test_camera_analytics_tool_schemas` - Schema validation
- `test_camera_analytics_safety_classification` - Safety classification

---
