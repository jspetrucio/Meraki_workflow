# Story 13.9: Static Routes (Appliance)

> **Epic:** 13 - Camera Analytics, Sensors & Observability
> **Sprint:** TBD
> **Priority:** P1 (platform depth)
> **Points:** 3
> **Type:** Backend/Python
> **Agent:** @dev
> **Depends on:** None (independent)

---

## Status

**Draft**

---

## Story

**As a** network engineer,
**I want** to manage static routes on MX appliances,
**so that** I can configure routing without OSPF/BGP.

---

## Acceptance Criteria

1. `discover_static_routes` returns all static routes with subnet, next hop, and enabled state
2. Full CRUD for static routes (create, update, delete)
3. `manage_static_route` validates subnet format and checks for overlapping routes
4. Backup created before any static route config change
5. Backup + rollback supported
6. Integration into `full_discovery()` output
7. Natural language: "add static route to 10.10.0.0/24 via 192.168.1.1" works

---

## Scope

| Layer | New Items | Details |
|-------|-----------|---------|
| `api.py` | 4 methods | `get_static_routes`, `create_static_route`, `update_static_route`, `delete_static_route` |
| `discovery.py` | 1 function | `discover_static_routes` |
| `config.py` | 1 function | `manage_static_route` |
| `agent_tools.py` | 3 schemas | meraki-specialist tools |
| Safety | MODERATE |

---

## Implementation Pattern

This story follows the standardized 7-step implementation pattern:

1. `api.py` -- Add SDK wrapper methods with `@log_api_call`
2. `discovery.py` -- Add discovery function with `client.safe_call()`
3. `config.py` -- Add config function with backup + `ConfigResult`
4. `agent_router.py` -- Register in `FUNCTION_REGISTRY`
5. `agent_tools.py` -- Add tool schemas + TOOL_SAFETY classification
6. `safety.py` -- Register in `SAFETY_CLASSIFICATION`
7. `tests/` -- Add comprehensive tests

**Note:** Both `SAFETY_CLASSIFICATION` (safety.py) and `TOOL_SAFETY` (agent_tools.py) must be updated.

---

## Tasks

- [ ] Add `get_static_routes`, `create_static_route`, `update_static_route`, `delete_static_route` to api.py with `@log_api_call`
- [ ] Add `discover_static_routes` to discovery.py with `client.safe_call()`
- [ ] Add hardware product-type guard for appliances (static routes available on MX)
- [ ] Add `manage_static_route` to config.py with backup + `ConfigResult`
- [ ] Add subnet validation (CIDR format) in `manage_static_route`
- [ ] Add overlap detection for conflicting routes
- [ ] Register static route functions in FUNCTION_REGISTRY (agent_router.py)
- [ ] Add 3 tool schemas to agent_tools.py (meraki-specialist)
- [ ] Register safety classifications in safety.py (MODERATE) and agent_tools.py (TOOL_SAFETY)
- [ ] Integrate static routes into `full_discovery()` output
- [ ] Add tests (target: >= 90% coverage)
- [ ] Verify all schemas pass `validate_tool_schema()` with `additionalProperties: False`

---

## File List

(To be populated during implementation)

---

## Dependencies

- Requires MX appliance hardware
- Static routing must be enabled (default on MX)

---

## Testing

### Expected Test Count: ~10-12 tests

**Test Coverage:**
- `test_get_static_routes` - API method
- `test_create_static_route` - API method
- `test_update_static_route` - API method
- `test_delete_static_route` - API method
- `test_discover_static_routes` - Discovery function
- `test_manage_static_route` - Config function with backup
- `test_static_route_subnet_validation` - CIDR format validation
- `test_static_route_overlap_detection` - Conflict detection
- `test_static_route_product_guard` - Hardware guard (skip when no MX)
- `test_function_registry_static_routes` - Router registration
- `test_static_route_tool_schemas` - Schema validation
- `test_static_route_safety_classification` - Safety classification (MODERATE)

---
