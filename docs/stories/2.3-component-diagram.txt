CNL Chat Interface - Component Hierarchy
=========================================

App
 â””â”€ ChatView (main container)
     â”œâ”€ Header
     â”‚   â”œâ”€ Title: "Chat"
     â”‚   â””â”€ ConnectionStatus (ðŸŸ¢ connected / ðŸŸ¡ connecting / ðŸ”´ disconnected)
     â”‚
     â”œâ”€ ScrollArea (message list)
     â”‚   â””â”€ MessageItem[] (for each message)
     â”‚       â”œâ”€ MessageBubble (text messages)
     â”‚       â”‚   â”œâ”€ Agent avatar + name (left side)
     â”‚       â”‚   â”œâ”€ Content bubble
     â”‚       â”‚   â”‚   â””â”€ Markdown rendering (via renderMarkdown())
     â”‚       â”‚   â”œâ”€ Timestamp (relative)
     â”‚       â”‚   â””â”€ User avatar (right side)
     â”‚       â”‚
     â”‚       â”œâ”€ StreamingText (for streaming messages)
     â”‚       â”‚   â”œâ”€ Progressive markdown
     â”‚       â”‚   â””â”€ Typing cursor animation
     â”‚       â”‚
     â”‚       â”œâ”€ DataRenderer (for {type: "data"})
     â”‚       â”‚   â”œâ”€ CodeBlock (code format)
     â”‚       â”‚   â”‚   â”œâ”€ Language badge
     â”‚       â”‚   â”‚   â”œâ”€ Copy button
     â”‚       â”‚   â”‚   â””â”€ Syntax-highlighted code
     â”‚       â”‚   â”œâ”€ TableView (table format)
     â”‚       â”‚   â”‚   â””â”€ HTML table with headers
     â”‚       â”‚   â”œâ”€ HtmlReportViewer (html format)
     â”‚       â”‚   â”‚   â”œâ”€ Expand/Collapse button
     â”‚       â”‚   â”‚   â””â”€ Sandboxed iframe
     â”‚       â”‚   â”œâ”€ DiffView (diff format)
     â”‚       â”‚   â”‚   â””â”€ Color-coded +/- lines
     â”‚       â”‚   â””â”€ JsonView (json format)
     â”‚       â”‚       â”œâ”€ Expand/Collapse button
     â”‚       â”‚       â””â”€ Pretty-printed JSON
     â”‚       â”‚
     â”‚       â””â”€ ConfirmDialog (for {type: "confirm"})
     â”‚           â”œâ”€ Warning icon + title
     â”‚           â”œâ”€ Danger level badge (low/medium/high)
     â”‚           â”œâ”€ Action description
     â”‚           â”œâ”€ Preview box
     â”‚           â”œâ”€ "CONFIRM" input (for danger_level=high)
     â”‚           â””â”€ Buttons (Confirm / Cancel)
     â”‚
     â”œâ”€ ScrollToBottomButton (floating, conditional)
     â”‚   â””â”€ ChevronDown icon
     â”‚
     â””â”€ ChatInput (fixed at bottom)
         â”œâ”€ Textarea (auto-resize)
         â””â”€ SendButton / StopButton (conditional)

Hooks Used:
-----------
useChat()
 â”œâ”€ sendMessage(content)
 â”œâ”€ sendConfirmResponse(requestId, approved)
 â”œâ”€ connectionStatus
 â””â”€ isStreaming

useWebSocket()
 â”œâ”€ Auto-connect on mount
 â”œâ”€ Handle WebSocket messages:
 â”‚   â”œâ”€ "stream" â†’ appendToLastAssistant()
 â”‚   â”œâ”€ "data" â†’ addMessage() with data
 â”‚   â”œâ”€ "confirm" â†’ addMessage() with confirmRequest
 â”‚   â”œâ”€ "agent_status" â†’ (future: typing indicator)
 â”‚   â”œâ”€ "error" â†’ addMessage() with error
 â”‚   â””â”€ "done" â†’ setStreaming(false)
 â”œâ”€ Ping/pong keepalive (30s interval)
 â””â”€ Auto-reconnect (3s delay)

Zustand Store (chatStore):
---------------------------
- sessions[]
- activeSessionId
- isStreaming
- activeMessages() â†’ Message[]
- addMessage()
- appendToLastAssistant()
- setStreaming()
- createSession()

WebSocket Protocol:
-------------------
Client â†’ Server:
 - {type: "message", content, session_id}
 - {type: "confirm_response", request_id, approved}
 - {type: "ping"}

Server â†’ Client:
 - {type: "stream", content, agent}
 - {type: "data", format, data, language}
 - {type: "confirm", action, preview, danger_level, request_id}
 - {type: "agent_status", ...}
 - {type: "error", error/message}
 - {type: "done"}
 - {type: "pong"}
