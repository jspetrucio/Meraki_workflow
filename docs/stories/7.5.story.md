# Story 7.5: Network Analyst Skill Migration

> **Epic:** 7 - Deterministic Task Executor & Modular Agent Architecture
> **Sprint:** S7 (Week 2)
> **Priority:** P1 (migration)
> **Points:** 5
> **Type:** Backend/Content
> **Agent:** @dev
> **Depends on:** Story 7.1 (Task Executor), Story 7.2 (Task Registry), Story 7.3 (Router Integration)

---

## Status

**Draft**

---

## Story

**As a** CNL platform developer,
**I want** the Network Analyst's 5 modular task files to have YAML frontmatter with step definitions,
**so that** the task executor can run them deterministically instead of the monolithic `.md` prompt.

---

## Acceptance Criteria

### Skill Files Unpacked

1. Extract `CNL_agents/network_analyst-skill.zip` to `CNL_agents/network-analyst/`
2. Directory structure matches spec: `tasks/`, `schemas/`, `hooks/`, `references/`
3. 14 files present (SKILL.md + 5 tasks + 2 schemas + 2 hooks + 4 references)

### YAML Frontmatter Added to Tasks

4. `tasks/discovery-completo.md` — frontmatter with steps: validate_client → snapshot_pre → full_discovery → find_issues → generate_suggestions → save_snapshot → generate_report
5. `tasks/health-check.md` — frontmatter with steps: resolve_network → get_health_metrics → assess_thresholds → generate_summary
6. `tasks/security-audit.md` — frontmatter with steps: resolve_targets → discover_firewall_rules → discover_ssids → analyze_security → generate_findings
7. `tasks/drift-detection.md` — frontmatter with steps: load_baseline → discover_current → compare_snapshots → generate_drift_report
8. `tasks/investigar-especifico.md` — frontmatter with steps: parse_intent (agent) → resolve_targets → investigate (agent) → summarize

### Trigger Keywords Defined

9. `discovery-completo`: [discovery, discover, scan, network scan, full analysis, analyze network, map network]
10. `health-check`: [health, health check, status, how is, performance, latency, uptime]
11. `security-audit`: [security, audit, vulnerability, firewall audit, compliance, security posture]
12. `drift-detection`: [drift, changed, difference, compare, baseline, what changed, config drift]
13. `investigar-especifico`: (no keywords — fallback task for network-analyst agent)

### Risk Levels

14. All Network Analyst tasks have `risk_level: low` (read-only operations)

### Legacy .md Preserved

15. `.claude/agents/network-analyst.md` remains as fallback (NOT deleted)
16. Legacy .md reduced to identity-only prompt (agent name, role, personality) — no step instructions
17. Step instructions removed from legacy .md and moved to modular tasks

---

## Technical Notes

### Step Types for Analyst Tasks
Most steps are `tool` type (calling discovery functions) or `agent` type (LLM interpretation).
No `gate` steps needed — analyst tasks are read-only.

### Hooks
- `hooks/pre-analysis.md` → validates client exists, checks API connectivity
- `hooks/post-analysis.md` → saves results, suggests follow-up actions

---

## Integration Verification

- **IV1:** `find_matching_task("do a full discovery of my network")` returns `discovery-completo`
- **IV2:** `find_matching_task("check the health of network N_123")` returns `health-check`
- **IV3:** `find_matching_task("configure a VLAN")` returns None (not an analyst task)
- **IV4:** Legacy flow still works when `use_modular_tasks=False`

---

## Dependencies

| Direction | Story | Title | Status |
|-----------|-------|-------|--------|
| Blocked by | 7.1 | Task Executor Core Engine | Draft |
| Blocked by | 7.2 | YAML Frontmatter Parser | Draft |
| Blocked by | 7.3 | Router Integration | Draft |

---

## Tasks

- [ ] Extract network_analyst-skill.zip to CNL_agents/network-analyst/
- [ ] Add YAML frontmatter to discovery-completo.md
- [ ] Add YAML frontmatter to health-check.md
- [ ] Add YAML frontmatter to security-audit.md
- [ ] Add YAML frontmatter to drift-detection.md
- [ ] Add YAML frontmatter to investigar-especifico.md
- [ ] Define trigger_keywords for each task
- [ ] Reduce .claude/agents/network-analyst.md to identity-only
- [ ] Write integration tests: keyword matching (target: 10+ tests)
- [ ] Write e2e test: message → task_executor → discovery steps

---

## File List

| File | Action | Description |
|------|--------|-------------|
| `CNL_agents/network-analyst/tasks/*.md` | MODIFY | Add YAML frontmatter |
| `CNL_agents/network-analyst/SKILL.md` | VERIFY | Hub file intact |
| `.claude/agents/network-analyst.md` | MODIFY | Reduce to identity-only |
| `tests/test_analyst_migration.py` | CREATE | Migration integration tests |

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Enabled
> **Quality Gate**: All 5 tasks parseable, keyword matching accurate, legacy fallback works
