# Story 2.2: Onboarding Wizard

> **Epic:** 2 - Chat Frontend
> **Sprint:** S4 (Week 4)
> **Priority:** P0 (first-time user experience)
> **Points:** 5
> **Type:** Frontend
> **Agent:** @dev
> **Depends on:** Story 2.1 (React Scaffold), Story 1.4 (Settings API)

---

## Status

**Draft**

---

## Story

**As a** first-time user,
**I want** a guided setup wizard that collects my credentials,
**so that** I can start using CNL within 2 minutes.

---

## Acceptance Criteria

1. Wizard triggers automatically on first launch (no settings.json exists / onboarding incomplete)
2. Step 1: Welcome screen explaining what CNL does (skip button available)
3. Step 2: Meraki credentials — API Key input + Org ID input with validation
4. Step 3: AI Provider selection (Claude/GPT/Gemini) + API key input with validation
5. Step 4: Success screen with "Start Discovery" CTA button
6. Each step validates input before allowing next (real API call to verify key works)
7. Progress indicator shows current step (1/4, 2/4, etc.)
8. Credentials saved via backend API (Story 1.4 settings endpoints)

---

## Integration Verification

- **IV1:** Credentials saved by wizard are readable by existing CLI commands
- **IV2:** "Start Discovery" button triggers actual discovery via WebSocket
- **IV3:** Wizard can be re-accessed from Settings for credential updates

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Enabled
> **Profile**: assertive
> **Quality Gates**: block_on_critical=true, require_resolution=true

### Applicable Path Instructions

**`frontend/src/**/*.tsx`** (OnboardingWizard.tsx, WelcomeStep.tsx, MerakiKeyStep.tsx, AIProviderStep.tsx, SuccessStep.tsx):
- CRITICAL: API key inputs must use `type="password"` — never display in plaintext
- CRITICAL: API keys must never be stored in component state after submission
- FOCUS: Component prop typing, hook dependency arrays, accessibility
- SKIP: JSX formatting, Tailwind class ordering

**`frontend/**/*.test.*`** (onboarding tests):
- VALIDATE: User interaction testing, proper async handling (waitFor, findBy)

### Review Focus for This Story
- Credential inputs must clear on unmount (no lingering keys in DOM or state)
- Validation API calls must use POST (not GET) to prevent key leakage in URLs/logs
- Step navigation must prevent submitting the same credentials twice (debounce)
- "Skip" button must not bypass required credential setup

---

## Tasks / Subtasks

- [ ] **T1: Create OnboardingWizard component** (AC: 1, 7)
  - [ ] T1.1: `frontend/src/components/onboarding/OnboardingWizard.tsx` — main wizard container
  - [ ] T1.2: State management: currentStep, formData, validationState, isLoading
  - [ ] T1.3: Check `GET /api/v1/settings/onboarding-status` on mount → redirect if complete
  - [ ] T1.4: Step indicator (1/4, 2/4...) using shadcn Progress or custom stepper
  - [ ] T1.5: Next/Back/Skip navigation buttons

- [ ] **T2: Welcome Step** (AC: 2)
  - [ ] T2.1: `WelcomeStep.tsx` — explains CNL capabilities (discovery, config, workflows)
  - [ ] T2.2: "Get Started" primary button + "Skip" secondary button
  - [ ] T2.3: Brief feature highlights with icons

- [ ] **T3: Meraki Credentials Step** (AC: 3, 6)
  - [ ] T3.1: `MerakiKeyStep.tsx` — API Key input (password type) + Org ID input
  - [ ] T3.2: "Validate" button → calls `POST /api/v1/credentials/validate` with `{type: "meraki"}`
  - [ ] T3.3: Show success: org name returned from validation
  - [ ] T3.4: Show error: clear message (invalid key, network error, etc.)
  - [ ] T3.5: Save via `POST /api/v1/credentials/provider/meraki`
  - [ ] T3.6: Help text with instructions for getting API key from Dashboard

- [ ] **T4: AI Provider Step** (AC: 4, 6)
  - [ ] T4.1: `AIProviderStep.tsx` — provider selector (Claude/GPT/Gemini/Ollama)
  - [ ] T4.2: API key input (hidden for Ollama which is local)
  - [ ] T4.3: "Validate" button → calls `POST /api/v1/credentials/validate` with `{type: "ai"}`
  - [ ] T4.4: Show success: "Connected to {provider}"
  - [ ] T4.5: Save via `POST /api/v1/credentials/provider/{name}`

- [ ] **T5: Success Step** (AC: 5)
  - [ ] T5.1: `SuccessStep.tsx` — confirmation with checkmarks for configured items
  - [ ] T5.2: "Start Discovery" CTA → navigate to chat + send "discover full" via WebSocket
  - [ ] T5.3: "Go to Settings" secondary button
  - [ ] T5.4: Mark onboarding complete via `PATCH /api/v1/settings`

- [ ] **T6: App routing** (AC: 1)
  - [ ] T6.1: In `App.tsx`, check onboarding status on mount
  - [ ] T6.2: If incomplete → show OnboardingWizard
  - [ ] T6.3: If complete → show main chat layout

- [ ] **T7: Write tests**
  - [ ] T7.1: Test wizard renders on first launch
  - [ ] T7.2: Test step navigation (next/back)
  - [ ] T7.3: Test validation API calls
  - [ ] T7.4: Test completion flow

---

## Dev Notes

### API Endpoints Used

[Source: Story 1.4 — settings_routes.py]

- `GET /api/v1/settings/onboarding-status` → `{complete: bool, missing: [...]}`
- `POST /api/v1/credentials/validate` → `{type: "meraki"|"ai", ...}` → `{valid: bool, message: str}`
- `POST /api/v1/credentials/provider/{name}` → `{api_key: str}` → save encrypted
- `PATCH /api/v1/settings` → partial update (ai_provider, ai_model, etc.)

### File Locations

| File | Location |
|------|----------|
| Wizard | `frontend/src/components/onboarding/OnboardingWizard.tsx` |
| Steps | `frontend/src/components/onboarding/WelcomeStep.tsx`, `MerakiKeyStep.tsx`, `AIProviderStep.tsx`, `SuccessStep.tsx` |

---

## Testing

- **Framework:** Vitest + React Testing Library
- **Location:** `frontend/src/components/onboarding/__tests__/`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1.0 | Story created from PRD + Architecture | River (SM) |
| 2026-02-05 | 0.1.1 | CodeRabbit integration enabled — assertive profile, path instructions + review focus added | River (SM) |

---

## Dev Agent Record

### Agent Model Used
_(To be filled by dev agent)_

### Debug Log References
_(To be filled by dev agent)_

### Completion Notes List
_(To be filled by dev agent)_

### File List
_(To be filled by dev agent)_

---

## QA Results
_(To be filled by QA agent)_
