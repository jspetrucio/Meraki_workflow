# Epic 7 — PO Validation Report

> **Reviewer:** @po (Pax)
> **Date:** 2026-02-07
> **Status:** ALL STORIES APPROVED (5 clean, 2 with notes)
> **Pipeline:** PM ✓ → Architect ✓ → SM ✓ → **PO ✓** → Dev (next)

---

## 1. Validation Methodology

Each story evaluated against 8 PO criteria:

| Criteria | Weight | Description |
|----------|--------|-------------|
| AC Clarity | HIGH | Are acceptance criteria unambiguous and testable? |
| AC Completeness | HIGH | Are all edge cases and scenarios covered? |
| Dependencies | HIGH | Are blockers and dependants correctly mapped? |
| Point Estimate | MEDIUM | Is effort proportional to complexity? |
| Dev Actionability | HIGH | Can a dev agent implement without asking questions? |
| Integration Points | MEDIUM | Are IVs specific and verifiable? |
| File List Accuracy | MEDIUM | Do files match the work described? |
| Architect Amendments | HIGH | Were all 6 tech review issues properly incorporated? |

---

## 2. Story-by-Story Validation

### Story 7.1 — Task Executor Core Engine (13 pts)

**Verdict: APPROVED WITH NOTES**

| Criteria | Score | Notes |
|----------|-------|-------|
| AC Clarity | 9/10 | Excellent. Each AC is specific and testable. |
| AC Completeness | 9/10 | 36 ACs cover models, executor, hooks, state, streaming, safety, errors. |
| Dependencies | 10/10 | Correctly blocks 7.3, 7.5, 7.6. No upward deps. |
| Point Estimate | 10/10 | 13 pts justified — largest story, 5 new files, async patterns. |
| Dev Actionability | 8/10 | See Note 1 below. |
| Integration Points | 9/10 | 3 IVs. IV1 references correct function path. |
| File List | 10/10 | 5 files: task_models.py, executor_utils.py, task_executor.py, agent_router.py (MODIFY), tests. |
| Architect Amendments | 10/10 | All 4 amendments applied: executor_utils (CRITICAL-1), task_models (MEDIUM-2), asyncio.Event (CRITICAL-2), safety.py (HIGH-2). |

**Note 1 — AC Numbering Collision:**
AC #6 appears twice — once for `TaskParseError` (line 36) and once for `TaskExecutor` class (line 40). The dev must be aware the second "6" should be "7" and subsequent ACs are off-by-one. This is a cosmetic issue only — the content is unambiguous.

**Note 2 — args_from Resolution Not Fully Specified:**
AC #13 says `Support args_from field — resolve arguments from previous step results` but doesn't specify the exact resolution mechanism. The Technical Notes section doesn't elaborate either. The dev will need to decide: dot-notation path (e.g., `intent.targets`), dictionary key lookup, or JSONPath.

**Recommendation:** Dev should implement simple dot-notation path resolution (e.g., `args_from: "step_name.field"` resolves to `step_results["step_name"]["field"]`) as the simplest approach. This is a low-risk decision that doesn't require story amendment.

---

### Story 7.2 — YAML Frontmatter Parser & Task Registry (5 pts)

**Verdict: APPROVED**

| Criteria | Score | Notes |
|----------|-------|-------|
| AC Clarity | 10/10 | Clear parser and registry contracts. |
| AC Completeness | 10/10 | Covers parsing, validation, matching, edge cases. Verb-awareness properly amended. |
| Dependencies | 10/10 | Correctly blocks 7.3, 7.5, 7.6. |
| Point Estimate | 10/10 | 5 pts reasonable for parser + registry + verb utils. |
| Dev Actionability | 10/10 | YAML example in AC#16 is excellent — shows exact format. |
| Integration Points | 9/10 | 3 IVs. IV3 (returns None on no match) is the critical fallback contract. |
| File List | 10/10 | 3 files: task_registry.py, verb_utils.py, tests. |
| Architect Amendments | 10/10 | HIGH-1 (verb-awareness) and MEDIUM-2 (import from task_models) applied. |

**No issues.** This story is clean and actionable.

---

### Story 7.3 — Router Integration & Feature Flag (10 pts)

**Verdict: APPROVED WITH NOTES**

| Criteria | Score | Notes |
|----------|-------|-------|
| AC Clarity | 10/10 | Priority order clearly specified. Code examples for WebSocket pattern. |
| AC Completeness | 9/10 | See Note 3 below. |
| Dependencies | 10/10 | Correctly blocked by 7.1+7.2, blocks 7.5+7.6. |
| Point Estimate | 10/10 | 10 pts correct per architect re-assessment (was 8). |
| Dev Actionability | 9/10 | WebSocket code example is excellent. See Note 4. |
| Integration Points | 10/10 | 4 IVs including CRITICAL-2 confirmation event verification. |
| File List | 10/10 | 4 files: agent_router.py, settings.py, server.py, tests. |
| Architect Amendments | 10/10 | All 4 amendments applied: server.py added, points updated, gate confirmation, priority reorder. |

**Note 3 — Concurrent Confirmation Handling:**
AC #21 says `Pending confirmation events expire after 300s` but doesn't specify what happens if a SECOND task starts while a first is pending confirmation. The `pending_confirmations` dict handles multiple request_ids, but the `async for` loop in the WebSocket handler (line 530) blocks on a single `process_message()` generator — a second `message` from the user during gate pause won't be processed until the first completes or times out.

**Impact:** Low. In practice, only one task runs per session at a time. The WebSocket handler loop structure naturally serializes tasks. However, the dev should add a comment documenting this single-task-per-session constraint.

**Note 4 — `_event` Field Stripping:**
The code example correctly strips `_event` from the dict before sending to the client (`chunk.pop("_event")`), which is good. Verify the dev doesn't accidentally break dict iteration by mutating during `async for`.

---

### Story 7.4 — New FUNCTION_REGISTRY Entries (5 pts)

**Verdict: APPROVED**

| Criteria | Score | Notes |
|----------|-------|-------|
| AC Clarity | 10/10 | Each function has exact signature, return format, and error handling. |
| AC Completeness | 10/10 | 22 ACs. All 4 functions + registry + schemas + safety classifications. |
| Dependencies | 10/10 | Correctly blocks 7.5, 7.6. Independent of 7.1-7.3. |
| Point Estimate | 10/10 | 5 pts for 4 wrapper functions + schemas + 16 tests. |
| Dev Actionability | 10/10 | Return dict shapes are explicit. API endpoints listed. Error fallback specified. |
| Integration Points | 10/10 | 3 IVs. IV1 (callable via _execute_function) tests actual runtime path. |
| File List | 10/10 | 4 files: config.py, agent_router.py, agent_tools.py, tests. |
| Architect Amendments | N/A | No amendments required for this story. |

**No issues.** Cleanest story in the epic. Excellent error handling specification (AC#6, #10, #15).

---

### Story 7.5 — Network Analyst Skill Migration (5 pts)

**Verdict: APPROVED**

| Criteria | Score | Notes |
|----------|-------|-------|
| AC Clarity | 10/10 | Step sequences per task are explicit. Trigger keywords listed verbatim. |
| AC Completeness | 9/10 | 17 ACs. Risk levels, legacy preservation, keyword mapping. |
| Dependencies | 10/10 | Correctly blocked by 7.1, 7.2, 7.3. |
| Point Estimate | 10/10 | 5 pts for content migration (5 tasks, no gate steps, read-only). |
| Dev Actionability | 10/10 | Zip file exists, directory structure specified, step names match existing functions. |
| Integration Points | 10/10 | 4 IVs including negative test (IV3: "configure a VLAN" returns None). |
| File List | 9/10 | 4 file entries. All accurate. |
| Architect Amendments | N/A | No amendments required for this story. |

**No issues.** Read-only nature makes this straightforward. Legacy .md preservation is the right safety net.

---

### Story 7.6 — Meraki Specialist Skill Migration (8 pts)

**Verdict: APPROVED**

| Criteria | Score | Notes |
|----------|-------|-------|
| AC Clarity | 10/10 | Safety pattern explicitly stated. Catalyst detection flow documented. |
| AC Completeness | 10/10 | 28 ACs. Safety gates, risk levels, catalyst/SGT flows, hooks, legacy preservation. |
| Dependencies | 10/10 | Correctly blocked by 7.1, 7.2, 7.3, 7.4. Most deps in the epic — appropriate. |
| Point Estimate | 10/10 | 8 pts justified: 6 tasks (more than analyst), safety sequences, catalyst flow. |
| Dev Actionability | 10/10 | `backup→preview→gate→apply→verify` is crystal clear. Catalyst detection abort condition explicit. |
| Integration Points | 10/10 | 5 IVs. IV4+IV5 verify the non-negotiable safety sequence. |
| File List | 9/10 | 4 file entries. |
| Architect Amendments | N/A | No amendments required for this story. |

**No issues.** This story embodies the core value proposition of the task executor. The enforced safety sequence is the reason this epic exists.

---

### Story 7.7 — Bug Fixes (2 pts)

**Verdict: APPROVED**

| Criteria | Score | Notes |
|----------|-------|-------|
| AC Clarity | 10/10 | 6 specific test cases for verb disambiguation (ACs 3-6). |
| AC Completeness | 10/10 | 12 ACs. Verb pre-pass, schema completion, reference check. Struck-through items clear. |
| Dependencies | 10/10 | Independent — correct. |
| Point Estimate | 10/10 | 2 pts correct per architect (reduced from 3 — config.py change removed). |
| Dev Actionability | 10/10 | Code example for verb pre-pass. Shared verb_utils dependency clear. |
| Integration Points | 10/10 | 3 IVs. IV2 (classification accuracy) is the key regression check. |
| File List | 10/10 | 3 active files (config.py struck through with explanation). |
| Architect Amendments | 10/10 | All 3 amendments applied: config.py removed (MEDIUM-1), points reduced, shared verb_utils (HIGH-1). |

**No issues.** Clean story. The struck-through items with explanations are good documentation of the architect's rationale.

---

## 3. Architect Amendment Verification

| Amendment | Severity | Target Stories | Applied? | Verification |
|-----------|----------|---------------|----------|--------------|
| CRITICAL-1: executor_utils.py extraction | CRITICAL | 7.1 | YES | File list has `scripts/executor_utils.py` CREATE. AC#9 references it. |
| CRITICAL-2: asyncio.Event gate mechanism | CRITICAL | 7.1, 7.3 | YES | 7.1 AC#11 has Event pattern. 7.3 ACs 17-21 have WebSocket handler mods. Code examples in both Technical Notes. |
| HIGH-1: Verb-aware keyword matching | HIGH | 7.2, 7.3, 7.7 | YES | 7.2 AC#12a has verb-awareness. 7.3 AC#5 reorders priority. 7.7 imports from verb_utils.py. |
| HIGH-2: safety.py integration | HIGH | 7.1 | YES | 7.1 ACs 29-33 explicitly integrate safety.py. Technical Notes reference safety functions. |
| MEDIUM-1: Remove config.py from 7.7 | MEDIUM | 7.7 | YES | AC#9 struck through. File list entry struck through with explanation. |
| MEDIUM-2: Shared task_models.py | MEDIUM | 7.1, 7.2 | YES | 7.1 file list has `task_models.py` CREATE. 7.2 AC#15 imports from it. |

**All 6 amendments verified as properly applied.**

---

## 4. Cross-Story Consistency Check

| Check | Status | Notes |
|-------|--------|-------|
| Epic points match story sum | PARTIAL | Epic says 47, sprint plan says 48. **Epic needs update.** 7.3: 8→10, 7.7: 3→2. Net +1. |
| Dependency graph consistent | YES | All stories agree on who blocks whom. |
| Shared files conflicts | CLEAN | agent_router.py touched by 7.1, 7.3, 7.4, 7.7 — wave sequence prevents conflicts. |
| Test targets cumulative | YES | ~112 new tests across all stories. Reasonable for scope. |
| Feature flag story | YES | Defined in 7.3, referenced in 7.5 and 7.6 for legacy fallback testing. |
| Data model ownership | YES | task_models.py created in 7.1, imported by 7.2 and downstream. |
| verb_utils.py ownership | YES | Created in 7.2, imported by 7.7 and 7.3 (transitively). |

**Action Required:** Update `docs/stories/7.0.epic.md` to reflect revised points:
- Story 7.3: 8 → 10
- Story 7.7: 3 → 2
- Total: 47 → 48

---

## 5. Risk Assessment (PO Perspective)

| Risk | PO Impact | Mitigation |
|------|-----------|------------|
| Story 7.1 is 13 points — largest by far | If it delays, entire epic slips | Sprint plan correctly sequences 7.1 first in Wave 1. task_models.py early delivery unblocks 7.2. |
| WebSocket gate confirmation is novel pattern | New async pattern = new bug surface | CRITICAL-2 code examples in 7.1 and 7.3 reduce ambiguity. Dedicated tests in both stories. |
| Wave 1 has soft dependency (7.2 needs task_models from 7.1) | Could block parallel execution | Sprint plan acknowledges this. Models are simple dataclasses — can be developed inline first. |
| 3 stories modify agent_router.py (7.1, 7.4, 7.7) in Wave 1 | Merge conflicts | Wave 1 changes are to different parts: 7.1=executor_utils extraction, 7.4=FUNCTION_REGISTRY additions, 7.7=_quick_classify verb pre-pass. Low conflict risk. |
| Migration stories (7.5, 7.6) depend on zip files | Zip contents might not match expectations | Zip files verified as existing. Contents should be validated first task in each story. |

---

## 6. Final Verdict

### Summary Table

| Story | Points | Verdict | Notes Count |
|-------|--------|---------|-------------|
| 7.1 | 13 | APPROVED WITH NOTES | 2 (AC numbering, args_from) |
| 7.2 | 5 | APPROVED | 0 |
| 7.3 | 10 | APPROVED WITH NOTES | 2 (concurrent confirmations, _event stripping) |
| 7.4 | 5 | APPROVED | 0 |
| 7.5 | 5 | APPROVED | 0 |
| 7.6 | 8 | APPROVED | 0 |
| 7.7 | 2 | APPROVED | 0 |

### Decision

**ALL 7 STORIES APPROVED FOR DEVELOPMENT.**

- 5 stories approved clean (7.2, 7.4, 7.5, 7.6, 7.7)
- 2 stories approved with non-blocking notes (7.1, 7.3)
- All architect amendments verified as applied
- Sprint plan wave structure validated
- Quality gates well-defined per wave

### Required Pre-Dev Action

1. **Update Epic 7.0 points:** 47 → 48 (reflect architect revisions to 7.3 and 7.7)

### Dev Notes to Carry Forward

1. Story 7.1: Fix AC numbering collision (two #6s)
2. Story 7.1: Use dot-notation for `args_from` resolution (simplest approach)
3. Story 7.3: Document single-task-per-session constraint in WebSocket handler
4. Story 7.3: Take care with `chunk.pop("_event")` during async iteration

---

**Proceed to @dev for Wave 1 execution.**

*— Pax, equilibrando prioridades*
