# Story 13.8: PoE Status Monitoring

> **Epic:** 13 - Camera Analytics, Sensors & Observability
> **Sprint:** TBD
> **Priority:** P1 (platform depth)
> **Points:** 2
> **Type:** Backend/Python
> **Agent:** @dev
> **Depends on:** None (uses existing `get_switch_port_statuses()` from Phase 1)

---

## Status

**Draft**

---

## Story

**As a** network engineer,
**I want** to monitor PoE power consumption and budget per switch,
**so that** I can prevent power overloads.

---

## Acceptance Criteria

1. `discover_poe_status` returns per-port PoE draw and total budget utilization
2. Issue detection: `poe_budget_exceeded` when >90% budget used
3. Integration into `full_discovery()` output
4. Natural language: "check PoE budget on switch X" works

---

## Scope

| Layer | New Items | Details |
|-------|-----------|---------|
| `api.py` | — | Uses existing `get_switch_port_statuses()` from Phase 1 |
| `discovery.py` | 1 function | `discover_poe_status` |
| `config.py` | — | Read-only monitoring, no config |
| `agent_tools.py` | 1 schema | network-analyst tool |
| Safety | SAFE |

---

## Implementation Pattern

This story follows the standardized 7-step implementation pattern:

1. `api.py` -- N/A (reuses existing `get_switch_port_statuses()`)
2. `discovery.py` -- Add discovery function with `client.safe_call()`
3. `config.py` -- N/A (read-only feature)
4. `agent_router.py` -- Register in `FUNCTION_REGISTRY`
5. `agent_tools.py` -- Add tool schemas + TOOL_SAFETY classification
6. `safety.py` -- Register in `SAFETY_CLASSIFICATION`
7. `tests/` -- Add comprehensive tests

**Note:** Both `SAFETY_CLASSIFICATION` (safety.py) and `TOOL_SAFETY` (agent_tools.py) must be updated.

---

## Tasks

- [ ] Add `discover_poe_status` to discovery.py with `client.safe_call()` (uses existing `get_switch_port_statuses()`)
- [ ] Add hardware product-type guard for switches (PoE only available on MS)
- [ ] Calculate total PoE budget utilization from port statuses
- [ ] Register PoE status function in FUNCTION_REGISTRY (agent_router.py)
- [ ] Add 1 tool schema to agent_tools.py (network-analyst)
- [ ] Register safety classifications in safety.py (SAFE) and agent_tools.py (TOOL_SAFETY)
- [ ] Add `poe_budget_exceeded` issue detection to `find_issues()`
- [ ] Integrate PoE status into `full_discovery()` output
- [ ] Add tests (target: >= 90% coverage)
- [ ] Verify all schemas pass `validate_tool_schema()` with `additionalProperties: False`

---

## File List

(To be populated during implementation)

---

## Dependencies

- Requires MS switch hardware with PoE capability
- Uses existing `get_switch_port_statuses()` method from Phase 1 (no new api.py methods needed)

---

## Testing

### Expected Test Count: ~6-8 tests

**Test Coverage:**
- `test_discover_poe_status` - Discovery function
- `test_poe_budget_calculation` - Budget utilization calculation
- `test_poe_budget_exceeded_issue` - Issue detection when >90%
- `test_poe_product_guard` - Hardware guard (skip when no MS)
- `test_function_registry_poe_status` - Router registration
- `test_poe_status_tool_schema` - Schema validation
- `test_poe_status_safety_classification` - Safety classification (SAFE)

---
