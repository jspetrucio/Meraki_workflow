# Story 9.2: Firmware Upgrades

> **Epic:** 9 - Alerts, Firmware & Observability
> **Sprint:** S8
> **Priority:** P0 (core operations)
> **Points:** 8
> **Type:** Backend/Python
> **Agent:** @dev
> **Depends on:** None (independent)

---

## Status

**Draft**

---

## Story

**As a** network admin,
**I want** to view firmware status and schedule upgrades,
**so that** I can keep all devices on supported firmware versions.

---

## Acceptance Criteria

1. `discover_firmware_status` returns current vs. latest firmware for all device types
2. `get_firmware_by_device` returns per-device firmware version and compliance status
3. `schedule_firmware_upgrade` supports scheduling upgrades for a specific time window
4. `cancel_firmware_upgrade` cancels a pending scheduled upgrade
5. Issue detection: `firmware_outdated` when devices are behind latest stable
6. Supports network-level and org-level firmware management
7. Note: Firmware downgrades are not supported by Meraki API; `cancel_firmware_upgrade` only works for pending (not yet applied) upgrades

---

## Scope

| Layer | New Items | Details |
|-------|-----------|---------|
| `api.py` | 3 methods | `get_firmware_upgrades`, `update_firmware_upgrades`, `get_firmware_by_device` |
| `discovery.py` | 1 function | `discover_firmware_status` |
| `config.py` | 2 functions | `schedule_firmware_upgrade`, `cancel_firmware_upgrade` |
| `agent_tools.py` | 3 schemas | meraki-specialist tools |
| Safety | DANGEROUS | Firmware changes require explicit confirmation |

---

## Implementation Pattern

This story follows the standardized 7-step implementation pattern:
1. `api.py` — Add SDK wrapper methods with `@log_api_call`
2. `discovery.py` — Add discovery function with `client.safe_call()`
3. `config.py` — Add config functions with backup + `ConfigResult`
4. `agent_router.py` — Register in `FUNCTION_REGISTRY`
5. `agent_tools.py` — Add tool schemas + TOOL_SAFETY classification
6. `safety.py` — Register in `SAFETY_CLASSIFICATION`
7. `tests/` — Add comprehensive tests

**Note:** Both `SAFETY_CLASSIFICATION` (safety.py) and `TOOL_SAFETY` (agent_tools.py) must be updated.

---

## Tasks

- [ ] Add api.py methods (`get_firmware_upgrades`, `update_firmware_upgrades`, `get_firmware_by_device`)
- [ ] Add discovery function to discovery.py (`discover_firmware_status`)
- [ ] Add config functions to config.py (`schedule_firmware_upgrade`, `cancel_firmware_upgrade`)
- [ ] Register in FUNCTION_REGISTRY (agent_router.py)
- [ ] Add tool schemas to agent_tools.py (3 schemas for meraki-specialist)
- [ ] Register safety classifications in safety.py and agent_tools.py (DANGEROUS)
- [ ] Add tests (target: >= 90% coverage)
- [ ] Verify all schemas pass validate_tool_schema()

---

## File List

(To be populated during implementation)

---
