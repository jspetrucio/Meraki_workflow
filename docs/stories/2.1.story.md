# Story 2.1: React App Scaffold & Design System

> **Epic:** 2 - Chat Frontend
> **Sprint:** S4 (Week 4)
> **Priority:** P0 (frontend foundation for all UI stories)
> **Points:** 3
> **Type:** Frontend
> **Agent:** @dev
> **Depends on:** Story 1.1 (FastAPI serves static files)

---

## Status

**Draft**

---

## Story

**As a** developer,
**I want** a React + TypeScript app with shadcn/ui and Tailwind configured,
**so that** I can build UI components with a consistent design system.

---

## Acceptance Criteria

1. React 19+ app created with Vite in `frontend/` directory
2. TypeScript configured with strict mode
3. Tailwind CSS + shadcn/ui installed and configured
4. Dark mode as default with light mode toggle
5. Base layout: sidebar (250px) | main chat area | optional right panel
6. Lucide icons integrated
7. Frontend builds to static files that FastAPI can serve
8. Dev mode with hot reload proxying API calls to FastAPI backend

---

## Integration Verification

- **IV1:** `npm run build` produces static files in `frontend/dist/`
- **IV2:** FastAPI serves built frontend at `localhost:3141/`
- **IV3:** Hot reload dev mode correctly proxies `/api/*` and `/ws/*` to FastAPI

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Enabled
> **Profile**: assertive
> **Quality Gates**: block_on_critical=true, require_resolution=true

### Applicable Path Instructions

**`frontend/src/**/*.tsx`** (AppLayout.tsx, ThemeToggle.tsx):
- FOCUS: Component prop typing (no 'any'), hook dependency arrays
- FOCUS: Accessibility (aria labels, semantic HTML)
- SKIP: JSX formatting, Tailwind class ordering

**`frontend/src/**/*.ts`** (stores, lib utilities):
- FOCUS: Strict typing, Zustand immutable updates, API client error handling

**`frontend/src/stores/**`** (chatStore, agentStore, settingsStore):
- VALIDATE: Immutable state updates, no side effects in store definitions

### Review Focus for This Story
- Vite proxy config must correctly forward `/api/*` and `/ws/*` to FastAPI backend
- Zustand store skeletons must define proper TypeScript interfaces
- `lib/api.ts` must handle fetch errors gracefully (network failures, non-JSON responses)
- Path aliases (`@/components`, etc.) must be configured in both tsconfig and vite config

---

## Tasks / Subtasks

- [ ] **T1: Create React + Vite project** (AC: 1, 2)
  - [ ] T1.1: `npm create vite@latest frontend -- --template react-ts`
  - [ ] T1.2: Configure TypeScript strict mode in `tsconfig.json`
  - [ ] T1.3: Set up path aliases: `@/components`, `@/hooks`, `@/stores`, `@/lib`
  - [ ] T1.4: Add `.gitignore` for `node_modules/`, `dist/`

- [ ] **T2: Install and configure Tailwind + shadcn/ui** (AC: 3, 6)
  - [ ] T2.1: Install Tailwind CSS 4+ and configure `tailwind.config.ts`
  - [ ] T2.2: Initialize shadcn/ui: `npx shadcn@latest init`
  - [ ] T2.3: Install base shadcn components: Button, Input, Card, Dialog, ScrollArea, Separator, Badge, Tooltip
  - [ ] T2.4: Install Lucide React icons: `npm install lucide-react`
  - [ ] T2.5: Configure global styles in `globals.css`

- [ ] **T3: Implement dark/light theme** (AC: 4)
  - [ ] T3.1: Create `ThemeProvider` component using CSS variables + `data-theme` attribute
  - [ ] T3.2: Dark mode as default (`data-theme="dark"`)
  - [ ] T3.3: Create `ThemeToggle` component (shadcn Switch or Button)
  - [ ] T3.4: Persist theme preference in localStorage

- [ ] **T4: Create base layout** (AC: 5)
  - [ ] T4.1: Create `AppLayout.tsx` with CSS Grid: sidebar | main | optional-panel
  - [ ] T4.2: Sidebar: 250px fixed width, collapsible
  - [ ] T4.3: Main area: flex-1, scrollable
  - [ ] T4.4: Right panel: hidden by default, expandable (for reports/context)
  - [ ] T4.5: Mobile responsive: sidebar hidden, hamburger menu

- [ ] **T5: Create Zustand stores skeleton** (AC: 5)
  - [ ] T5.1: Install Zustand: `npm install zustand`
  - [ ] T5.2: Create `stores/chatStore.ts` — messages, activeSession, isStreaming
  - [ ] T5.3: Create `stores/agentStore.ts` — activeAgent, agentList, connectionStatus
  - [ ] T5.4: Create `stores/settingsStore.ts` — theme, language, settings cache

- [ ] **T6: Configure Vite proxy for development** (AC: 8)
  - [ ] T6.1: In `vite.config.ts`, proxy `/api/*` to `http://localhost:3141`
  - [ ] T6.2: Proxy `/ws/*` to `ws://localhost:3141` (WebSocket)
  - [ ] T6.3: Set dev server port to 5173

- [ ] **T7: Verify build and integration** (AC: 7)
  - [ ] T7.1: `npm run build` produces `frontend/dist/index.html`
  - [ ] T7.2: FastAPI serves `frontend/dist/` as static files (from Story 1.1)
  - [ ] T7.3: Verify CORS works between Vite dev (5173) and FastAPI (3141)

- [ ] **T8: Create lib utilities** (AC: all)
  - [ ] T8.1: `lib/api.ts` — REST API client (fetch wrapper with base URL)
  - [ ] T8.2: `lib/types.ts` — TypeScript interfaces matching backend Pydantic models
  - [ ] T8.3: `lib/ws.ts` — WebSocket client skeleton (connect, send, receive)

---

## Dev Notes

### Frontend Architecture

[Source: architecture.md#5.6 React Frontend]

```
frontend/src/
├── App.tsx                    # Root: Router, WebSocket provider
├── main.tsx                   # Entry point
├── components/
│   ├── chat/                  # Chat UI (Story 2.3)
│   ├── sidebar/               # Agent sidebar (Story 2.4)
│   ├── onboarding/            # Setup wizard (Story 2.2)
│   ├── settings/              # Settings panel (Story 2.5)
│   └── common/                # Header, StatusBadge, ThemeToggle
├── hooks/                     # useWebSocket, useChat, useSettings
├── stores/                    # Zustand: chatStore, agentStore, settingsStore
├── lib/                       # api.ts, ws.ts, types.ts
└── styles/
    └── globals.css
```

### Frontend Standards

[Source: architecture.md#10.2 New Standards (Frontend)]

- Prettier + ESLint with TypeScript strict mode
- Functional components with hooks (no class components)
- Zustand stores in `stores/`, component-local state with `useState`
- Tailwind utility classes; shadcn/ui for complex components
- `PascalCase.tsx` components, `camelCase.ts` utilities/hooks

### Zustand Store Pattern

[Source: architecture.md#5.6 React Frontend - Zustand Store]

```typescript
interface ChatStore {
  messages: Message[];
  activeSession: string;
  isStreaming: boolean;
  addMessage: (msg: Message) => void;
  appendToLast: (chunk: string) => void;
  setStreaming: (v: boolean) => void;
}

const useChatStore = create<ChatStore>((set) => ({
  messages: [],
  activeSession: generateSessionId(),
  isStreaming: false,
  addMessage: (msg) => set((s) => ({ messages: [...s.messages, msg] })),
  appendToLast: (chunk) => set((s) => ({
    messages: s.messages.map((m, i) =>
      i === s.messages.length - 1 ? { ...m, content: m.content + chunk } : m
    ),
  })),
  setStreaming: (v) => set({ isStreaming: v }),
}));
```

### File Locations

| File | Location | Purpose |
|------|----------|---------|
| Vite config | `frontend/vite.config.ts` | Build + proxy |
| Tailwind config | `frontend/tailwind.config.ts` | Theme + design tokens |
| Layout | `frontend/src/components/common/AppLayout.tsx` | Base layout |
| Theme | `frontend/src/components/common/ThemeToggle.tsx` | Dark/light toggle |

---

## Testing

- **Framework:** Vitest
- **Location:** `frontend/src/__tests__/`
- **Focus:** Component rendering, store behavior

Run: `cd frontend && npm test`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1.0 | Story created from PRD + Architecture | River (SM) |
| 2026-02-05 | 0.1.1 | CodeRabbit integration enabled — assertive profile, path instructions + review focus added | River (SM) |

---

## Dev Agent Record

### Agent Model Used
_(To be filled by dev agent)_

### Debug Log References
_(To be filled by dev agent)_

### Completion Notes List
_(To be filled by dev agent)_

### File List
_(To be filled by dev agent)_

---

## QA Results
_(To be filled by QA agent)_
